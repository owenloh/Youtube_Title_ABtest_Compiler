<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Title A/B Test Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { margin-bottom: 20px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 { font-size: 12px; color: #666; margin-bottom: 5px; }
        .stat-card .value { font-size: 28px; font-weight: bold; }
        .filters { margin-bottom: 15px; }
        .filters button {
            padding: 8px 16px;
            margin-right: 8px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .filters button.active { background: #007bff; color: white; border-color: #007bff; }
        table { width: 100%; background: white; border-collapse: collapse; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background: #f8f9fa; font-weight: 600; }
        tr:hover { background: #f8f9fa; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
        .badge.active { background: #28a745; color: white; }
        .badge.inactive { background: #6c757d; color: white; }
        .loading { text-align: center; padding: 40px; color: #666; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>YouTube Title A/B Test Tracker</h1>
        <div class="stats" id="stats"></div>
        <div class="filters">
            <button class="active" data-filter="active">Active</button>
            <button data-filter="inactive">Inactive</button>
            <button data-filter="all">All</button>
        </div>
        <div id="loading" class="loading">Loading...</div>
        <table id="videos-table" style="display: none;">
            <thead>
                <tr>
                    <th>Video</th>
                    <th>Channel</th>
                    <th>Published</th>
                    <th>Status</th>
                    <th>Titles</th>
                    <th>Samples</th>
                    <th>Comment</th>
                </tr>
            </thead>
            <tbody id="videos-body"></tbody>
        </table>
    </div>
    <script>
        let allVideos = [];
        let currentFilter = 'active';

        async function loadData() {
            try {
                const [statsRes, videosRes] = await Promise.all([
                    fetch('/api/stats'),
                    fetch('/api/videos')
                ]);
                if (!statsRes.ok || !videosRes.ok) throw new Error('Failed to load');
                const stats = await statsRes.json();
                const videos = await videosRes.json();
                allVideos = videos.videos || [];
                displayStats(stats);
                filterVideos(currentFilter);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('videos-table').style.display = 'table';
            } catch (e) {
                document.getElementById('loading').textContent = 'Error loading data';
            }
        }

        function displayStats(stats) {
            document.getElementById('stats').innerHTML = `
                <div class="stat-card"><h3>Active</h3><div class="value">${stats.active_videos || 0}</div></div>
                <div class="stat-card"><h3>With Comments</h3><div class="value">${stats.with_comments || 0}</div></div>
                <div class="stat-card"><h3>Inactive</h3><div class="value">${stats.inactive_videos || 0}</div></div>
                <div class="stat-card"><h3>Total</h3><div class="value">${stats.total_in_db || 0}</div></div>
            `;
        }

        function filterVideos(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filters button').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            
            let filtered = allVideos;
            if (filter === 'active') filtered = allVideos.filter(v => v.is_active);
            else if (filter === 'inactive') filtered = allVideos.filter(v => !v.is_active);
            displayVideos(filtered);
        }

        function displayVideos(videos) {
            document.getElementById('videos-body').innerHTML = videos.map(v => {
                const url = `https://youtube.com/watch?v=${v.video_id}`;
                const commentUrl = v.comment_id ? `${url}&lc=${v.comment_id}` : '';
                const status = v.is_active ? '<span class="badge active">Active</span>' : '<span class="badge inactive">Inactive</span>';
                let comment = '-';
                if (v.comment_id) {
                    const statusText = v.comment_status === 'heldForReview' ? ' (held)' : 
                                       v.comment_status === 'published' ? '' : 
                                       v.comment_status ? ` (${v.comment_status})` : '';
                    comment = `<a href="${commentUrl}" target="_blank">View${statusText}</a>`;
                }
                return `<tr>
                    <td><a href="${url}" target="_blank">${v.video_id}</a></td>
                    <td>${v.channel_name}</td>
                    <td>${formatDate(v.published_at)}</td>
                    <td>${status}</td>
                    <td>${v.unique_titles || 0}</td>
                    <td>${v.total_samples || 0}</td>
                    <td>${comment}</td>
                </tr>`;
            }).join('');
        }

        function formatDate(d) {
            if (!d) return '-';
            return new Date(d).toLocaleDateString();
        }

        document.querySelectorAll('.filters button').forEach(b => {
            b.addEventListener('click', () => filterVideos(b.dataset.filter));
        });

        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>
